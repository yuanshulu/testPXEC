(window.webpackJsonp=window.webpackJsonp||[]).push([[21,5,6],{338:function(t,e,r){var content=r(348);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(89).default)("172e4298",content,!0,{sourceMap:!1})},339:function(t,e,r){"use strict";r.r(e);var n={name:"Table",props:{items:{type:Array,default:function(){return[]}},fields:{type:Array,default:function(){return[{key:"createTime",label:"上傳時間",_style:"width:20%"},{key:"itemNo",label:"產品編號",_style:"width:20%"},{key:"barcode",label:"產品條碼",_style:"width:20%"},{key:"productName",label:"產品名稱",_style:"width:40%"}]}},caption:{type:String,default:"Table"}},methods:{}},o=r(12),component=Object(o.a)(n,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("CCard",[r("CCardHeader",[t._t("header",(function(){return[r("CIcon",{attrs:{name:"cil-grid"}}),t._v(" "+t._s(t.caption)+" ")]})),t._v(" "),r("span",{staticClass:"float-right",attrs:{color:"success"}},[t._v("匯入的商品資料30天內須編輯完成，若未編輯完成則會找不到資料")])],2),t._v(" "),r("CCardBody",[r("CDataTable",{attrs:{border:!0,items:t.items,fields:t.fields,pagination:!1}})],1)],1)}),[],!1,null,"37b73074",null);e.default=component.exports},340:function(t,e,r){"use strict";r.r(e);var n={name:"PreviewDataTable",props:{items:{type:Array,default:function(){return[]}},fields:{type:Array,default:function(){return[{key:"itemNo",label:"產品編號",_style:"width:20%"},{key:"barcode",label:"產品條碼",_style:"width:20%"},{key:"productName",label:"產品名稱",_style:"width:40%"}]}},caption:{type:String,default:"Table"},subtitle:{type:String,default:""}},methods:{}},o=r(12),component=Object(o.a)(n,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("CCard",[r("CCardHeader",[t._t("header",(function(){return[r("CIcon",{attrs:{name:"cil-grid"}}),t._v(" "+t._s(t.caption)+" ")]})),t._v(" "),r("span",{staticClass:"float-right",attrs:{color:"success"}},[t._v(t._s(t.subtitle))])],2),t._v(" "),r("CCardBody",[r("CDataTable",{attrs:{border:!0,items:t.items,fields:t.fields,pagination:!1}})],1)],1)}),[],!1,null,"355f99d6",null);e.default=component.exports},347:function(t,e,r){"use strict";r(338)},348:function(t,e,r){var n=r(88)(!1);n.push([t.i,".msgfade-enter-active[data-v-75586c77],.msgfade-leave-active[data-v-75586c77]{transition:opacity 1.5s}.msgfade-enter[data-v-75586c77],.msgfade-leave-to[data-v-75586c77]{opacity:0}",""]),t.exports=n},363:function(t,e,r){"use strict";r.r(e);r(21);var n=r(339),o=r(340),l={name:"ImportFromExcel",components:{CTableWrapper:n.default,CPreviewDataTableWrapper:o.default},data:function(){return{successMessage:"",errorMessage:"",fileInfo:{fileName:"",fileData:null},state:"",sessionDrafts:[],recentlyDrafts:[]}},computed:{sessionTitle:function(){return null!==this.fileInfo&&null!==this.fileInfo.fileName&&""!==this.fileInfo.fileName?"檔案名稱: "+this.fileInfo.fileName:""},sessionSubtitle:function(){return"共 "+this.sessionDrafts.length+" 筆"}},mounted:function(){this.setState("init")},methods:{chooseFiles:function(){this.setState("init"),document.getElementById("fileUpload").value="",document.getElementById("fileUpload").click()},setState:function(t){"init"===t||"review"===t||"done"===t?(this.state=t,"init"===this.state&&(this.errorMessage="",this.sessionDrafts=[]),"init"!==this.state&&"done"!==this.state||(this.fileInfo={fileName:"",fileData:null},this.setRecentlyDrafts())):alert("ERROR state")},handleFileUpload:function(){var t=document.getElementById("fileUpload").files;if(0!==t.length){var e=t[0];if(e.size>1048576)this.errorMessage="檔案太大，請重新上傳";else{var r=this,n=new FileReader;n.onloadend=function(t){console.log("reader.result: "+n.result),r.fileInfo={fileName:e.name,fileData:n.result},r.submitForm(!0),document.getElementById("fileUpload").value=""},n.readAsDataURL(e)}}},submitForm:function(t){var e=this;if(t){var r=this.$store.state.urls.uploadProductDraftsPreview;console.log("uploadProductDraftsPreview, call "+r);var n={file_name:this.fileInfo.fileName,file_data:this.fileInfo.fileData};this.axios.post(r,n).then((function(t){if(t.data.code===e.$store.state.success){var data=t.data.data;for(var i in data){var r=data[i];e.sessionDrafts.push({itemNo:r.item_no,barcode:r.barcode,productName:r.product_name})}}console.log(t.data)})).then((function(){e.setState("review")}))}else{var o=this.$store.state.urls.uploadProductDrafts;console.log("uploadProductDrafts, call "+o);var l={file_name:this.fileInfo.fileName,file_data:this.fileInfo.fileData};this.$axios.post(o,l).then((function(t){if(t.data.code===e.$store.state.success){var data=t.data.data;e.successMessage="新增完成！共 "+data+" 筆商品"}console.log(t.data)})).then((function(){e.setState("done")}))}},submitSession:function(){console.log("submitSession"),null!==this.fileInfo&&this.fileInfo.fileName||alert("沒有指定的上傳檔案"),this.submitForm(!1)},resetSession:function(){console.log("resetSession"),this.setState("init")},gotoAddProduct:function(){console.log("gotoAddProduct"),this.$router.push("/product/addProduct")},setRecentlyDrafts:function(){var t=this,e=this.$store.state.urls.listProductDraftsWithin30Days;console.log("listProductDraftsWithin30Days => "+e),this.$axios.get(e).then((function(e){if(t.recentlyDrafts=[],e.data.code===t.$store.state.success){var data=e.data.data;for(var i in data){var r=data[i];t.recentlyDrafts.push({createTime:r.create_time,itemNo:r.item_no,barcode:r.barcode,productName:r.product_name})}}})).catch((function(t){console.log("error @setRecentlyDrafts",t)}))}}},c=(r(347),r(12)),component=Object(c.a)(l,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("CRow",[r("CCol",{attrs:{md:"12"}},[r("CCard",[r("CCardHeader",[r("h3",[t._v("商品上傳")])]),t._v(" "),r("CCardBody",[r("CAlert",{directives:[{name:"show",rawName:"v-show",value:t.errorMessage,expression:"errorMessage"}],staticClass:"text-center",attrs:{color:"danger"}},[t._v(t._s(t.errorMessage))]),t._v(" "),r("CAlert",{directives:[{name:"show",rawName:"v-show",value:t.successMessage,expression:"successMessage"}],staticClass:"text-center",attrs:{color:"secondary"}},[r("CIcon",{attrs:{name:"cil-check"}}),t._v(" "+t._s(t.successMessage))],1),t._v(" "),r("CForm",["init"==t.state?r("CCard",{staticClass:"text-center",attrs:{"body-wrapper":""}},[r("blockquote",{staticClass:"card-blockquote"},[r("button",{staticStyle:{display:"inline-block",padding:"8px 20px",border:"1px solid silver","border-radius":"10px"},attrs:{type:"button"},on:{click:function(e){return t.chooseFiles()}}},[r("svg",{staticClass:"bi bi-upload",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"currentColor",viewBox:"0 0 16 16"}},[r("path",{attrs:{d:"M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"}}),t._v(" "),r("path",{attrs:{d:"M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"}})])]),t._v(" "),r("input",{attrs:{id:"fileUpload",type:"file",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",hidden:""},on:{change:t.handleFileUpload}}),t._v(" "),r("h4",{staticStyle:{"margin-top":"8px"}},[t._v("請選擇要上傳的檔案")]),t._v(" "),r("p",[t._v("\n                  檔案格式xlsx，檔案大小限制1mb以內，欄位名稱、工作表名稱需同範本\n                ")])])]):t._e(),t._v(" "),"review"==t.state&&t.sessionDrafts.length>0?r("CCard",[r("CPreviewDataTableWrapper",{attrs:{items:t.sessionDrafts,subtitle:t.sessionSubtitle,caption:t.sessionTitle}})],1):t._e(),t._v(" "),"review"==t.state&&t.sessionDrafts.length>0?r("CCol",{staticClass:"text-center",attrs:{md:"12"}},[r("button",{staticClass:"btn-secondary btn btn-lg",staticStyle:{display:"inline-block"},attrs:{type:"button"},on:{click:function(e){return t.resetSession()}}},[t._v("\n                重新上傳\n              ")]),t._v(" "),r("button",{staticClass:"btn-primary btn btn-lg ml-4",staticStyle:{display:"inline-block"},attrs:{type:"button"},on:{click:function(e){return t.submitSession()}}},[t._v("\n                確定新增\n              ")])]):t._e(),t._v(" "),r("CCol",{directives:[{name:"show",rawName:"v-show",value:"done"==t.state,expression:"state == 'done'"}],staticClass:"text-center",attrs:{md:"12"}},[r("button",{staticClass:"btn-info btn btn-lg",staticStyle:{display:"inline-block"},attrs:{type:"button"},on:{click:function(e){return t.gotoAddProduct()}}},[t._v("\n                前往編輯商品\n              ")])])],1)],1),t._v(" "),r("CCardFooter")],1)],1)],1),t._v(" "),r("CRow",[r("CCol",{attrs:{md:"12"}},[r("CTableWrapper",{attrs:{items:t.recentlyDrafts},scopedSlots:t._u([{key:"header",fn:function(){return[r("CIcon",{attrs:{name:"cil-grid"}}),t._v(" 近30天上傳紀錄\n          "),r("div",{staticClass:"card-header-actions"})]},proxy:!0}])})],1)],1)],1)}),[],!1,null,"75586c77",null);e.default=component.exports}}]);