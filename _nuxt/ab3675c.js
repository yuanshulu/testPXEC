(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{358:function(t,e,o){"use strict";o.r(e);o(182),o(41),o(122),o(38);var r={name:"AddProduct",data:function(){return{pageTitle:"",searchText:"",state:"",basic:{},selected:[],show:!0,product:{id:0,price:0,dealSettings:[],tagNames:[],uploadImgs:[],deliveryModes:[],inventoryQuantity:0,shortLived:"",appreciationPeriod:"",salesFocus:"",features:"",others:"",rejectCommand:""},horizontal:{label:"col-3",input:"col-9"},yesNoOptions:[{value:"1",label:"是"},{value:"0",label:"否"}],tagOptions:[],options:["Option 1","Option 2","Option 3"],selectOptions:["Option 1","Option 2","Option 3",{value:"some value",label:"Selected option"}],deliveryModeOptions:["宅配","門市"],selectedOption:"some value",formCollapsed:!0,checkboxNames:["Checkboxes","Inline Checkboxes","Checkboxes - custom","Inline Checkboxes - custom"],radioNames:["Radios","Inline Radios","Radios - custom","Inline Radios - custom"],salesFocusLabel:"銷售重點(餘500字)",featuresLabel:"產品特色(餘500字)",othersLabel:"其他說明(選填)(餘500字)"}},mounted:function(){this.$route.params.pid?(this.product.id=this.$route.params.pid,this.pageTitle="商品明細",this.getBasicFromProduct(this.$route.params.pid),this.getProductForUpdate(this.$route.params.pid),this.setState("edit")):(this.pageTitle="新增商品",this.setState("search")),0===this.product.dealSettings.length&&this.addDealSetting()},methods:{checkPrice:function(){this.product.price>this.basic.original_price&&(alert("團購價格不得大於商品原價"),this.product.price=0)},checkProfit:function(t){t.profit>this.basic.gross_profit&&(alert("利潤不得大於毛利"+this.basic.gross_profit),t.profit=this.basic.gross_profit)},calcWordCount:function(t){switch(t){case"salesFocus":this.salesFocusLabel="銷售重點(餘"+(500-this.product.salesFocus.length)+"字)";break;case"features":this.featuresLabel="產品特色(餘"+(500-this.product.features.length)+"字)";break;case"others":this.othersLabel="其他說明(選填)(餘"+(500-this.product.others.length)+"字)"}},chooseFiles:function(){this.product.uploadImgs.length>=3||(document.getElementById("fileUpload").value="",document.getElementById("fileUpload").click())},deleteImg:function(t){this.product.uploadImgs.splice(t,1)},handleFileUpload:function(){var t=document.getElementById("fileUpload").files;if(0!==t.length){var e=t[0];if(e.size>512e3)this.errorMessage="檔案超過500KB";else{var o=this,r=new FileReader;r.onloadend=function(t){console.log("reader.result: "+r.result);var image=new Image;image.src=t.target.result,image.onload=function(){var t=this.height,e=this.width;return 600!==t||600!==e?(alert("圖片尺寸為600*600px"),!1):(o.putToFileStorage({user_id:0,is_watermark:!1,base64:r.result}),!0)},document.getElementById("fileUpload").value=""},r.readAsDataURL(e)}}},putToFileStorage:function(t){var e=this,o=this.$store.state.urls.fileUpload;console.log("fileUpload => "+o),this.$axios.post(o,t).then((function(t){t.data.code===e.$store.state.success&&e.product.uploadImgs.push(t.data.data.full_img_url)}))},addDealSetting:function(i){this.product.dealSettings.push({})},deleteDealSetting:function(i){window.confirm("要移除 "+this.product.dealSettings[i].quantityCondition+" 件成團的規則嗎?")&&this.product.dealSettings.splice(i,1)},setState:function(t){"search"===t||"edit"===t?this.state=t:alert("ERROR state")},searchByItemNo:function(){this.getBasicFromDraft(this.searchText)},getBasicFromDraft:function(t){var e=this,o=this.$store.state.urls.getProductBasic+"?source=draft&itemNo="+t;console.log("getProductBasic from draft => "+o),this.$axios.get(o).then((function(t){t.data.code===e.$store.state.success&&(e.basic=t.data.data,e.basic.source="draft",e.product.deliveryModes=e.basic.delivery_modes.split(","),e.tagOptions=e.basic.tag_names,e.tagOptions.unshift("無"),console.log("draft basic get from "+e.basic.source+" "+e.basic.id),e.setState("edit"))}))},getBasicFromProduct:function(t){var e=this,o=this.$store.state.urls.getProductBasic+"?productId="+t;console.log("getProductBasic => "+o),this.$axios.get(o).then((function(t){t.data.code===e.$store.state.success&&(e.basic=t.data.data,e.basic.source="",console.log("product basic get from "+e.basic.source+" "+e.basic.id),e.setState("edit"))}))},getProductForUpdate:function(t){var e=this,o=this.$store.state.urls.getProductForUpdate+"?productId="+t;console.log("getProductForUpdate => "+o),this.$axios.get(o).then((function(t){t.data.code===e.$store.state.success&&e.setProductData(t.data.data)}))},setProductData:function(p){this.product.id=p.id,""!==p.tag_names&&(this.product.tagNames=p.tag_names.split(",")),this.product.tagNames.unshift("無"),this.product.shortLived=p.short_lived?"1":"0",this.product.appreciationPeriod=p.appreciation_period?"1":"0",this.product.inventoryQuantity=p.inventory_quantity,this.product.price=p.price,this.product.uploadImgs=[],p.pic&&this.product.uploadImgs.push(p.pic),p.pic2&&this.product.uploadImgs.push(p.pic2),p.pic3&&this.product.uploadImgs.push(p.pic3),this.product.dealSettings=p.deal_settings,this.product.salesFocus=p.sales_focus,this.product.features=p.features,this.product.others=p.others,""!==p.delivery_modes&&(this.product.deliveryModes=p.delivery_modes.split(",")),this.product.rejectCommand=p.reject_command.comment},cancel:function(){confirm("是否確定要取消編輯，目前的修改都不會儲存?")&&(null===this.product.id||0===this.product.id?(this.searchText="",this.state="search"):this.$router.push("/product/productList"))},save:function(){var t=this;if(null!==this.basic&&0!==this.basic.id){if(console.log("this.product.deliveryModes="+this.product.deliveryModes),""===this.product.deliveryModes)return alert("配送方式為必填欄位"),!1;if(0===this.product.price)return alert("團購價格不得為0"),!1;if(""===this.product.uploadImgs)return alert("商品圖片為必填欄位"),!1;if(0===this.product.inventoryQuantity)return alert("庫存數量不得為0"),!1;if(!1===Object.keys(this.product.dealSettings[0]))return alert("跟團規則為必填欄位"),!1;if(this.product.dealSettings.length>3)return alert("跟團規則上限最多3組"),!1;if(""===this.product.tagNames)return alert("強檔設定為必填欄位"),!1;if(""===this.product.shortLived)return alert("是否為短效期為必填欄位"),!1;if(""===this.product.appreciationPeriod)return alert("是否適用7天鍵賞期為必填欄位"),!1;if(""===this.product.salesFocus)return alert("銷售重點為必填欄位"),!1;if(""===this.product.features)return alert("產品特色為必填欄位"),!1;if(null===this.product.id||0===this.product.id){var e=this.$store.state.urls.addProduct;console.log("addProduct => "+e);var o={draft_id:this.basic.id,product_id:this.product.id,price:this.product.price,deal_settings:this.product.dealSettings,pics:this.product.uploadImgs,tag_names:this.product.tagNames,inventory_quantity:this.product.inventoryQuantity,short_lived:"1"===this.product.shortLived,appreciation_period:"1"===this.product.appreciationPeriod,sales_focus:this.product.salesFocus,features:this.product.features,others:this.product.others,delivery_modes:this.product.deliveryModes};this.$axios.post(e,o).then((function(e){e.data.code===t.$store.state.success&&t.$router.push("/product/productList")})).catch((function(t){alert(t)}))}else{var r=this.$store.state.urls.updateProduct;console.log("updateProduct => "+r);var c={product_id:this.product.id,price:this.product.price,deal_settings:this.product.dealSettings,pics:this.product.uploadImgs,tag_names:this.product.tagNames,inventory_quantity:this.product.inventoryQuantity,short_lived:"1"===this.product.shortLived,appreciation_period:"1"===this.product.appreciationPeriod,sales_focus:this.product.salesFocus,features:this.product.features,others:this.product.others,delivery_modes:this.product.deliveryModes};this.$axios.post(r,c).then((function(e){e.data.code===t.$store.state.success&&t.$router.push("/product/productList")})).catch((function(t){console.log(t)}))}}else alert("Data is incomplete, cancel save")}}},c=o(12),component=Object(c.a)(r,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("CRow",[o("CCol",{attrs:{md:"12"}},[o("a",{staticClass:"col-form-label col-sm-3",attrs:{href:"/product"}},[t._v("\n          回商品列表\n         ")]),t._v(" "),o("CCard",[o("CCardHeader",[o("h3",[t._v(t._s(t.pageTitle))]),t._v(" "),""!=t.product.rejectCommand?o("div",[o("br"),t._v(" "),o("h5",[t._v("審核未過的原因")]),t._v(" "),o("p",[t._v(t._s(t.product.rejectCommand))])]):t._e()]),t._v(" "),o("CCardBody",["search"===t.state?o("CInput",{attrs:{description:"輸入單品貨號帶出資料",label:"單品貨號",horizontal:""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchByItemNo()}},scopedSlots:t._u([{key:"append",fn:function(){return[o("CButton",{attrs:{color:"light"},on:{click:function(e){return t.searchByItemNo()}}},[o("CIcon",{attrs:{name:"cil-magnifying-glass"}})],1)]},proxy:!0}],null,!1,1142057800),model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}}):t._e(),t._v(" "),o("CForm",{directives:[{name:"show",rawName:"v-show",value:"edit"===t.state,expression:"state === 'edit'"}]},[o("CInput",{attrs:{label:"單品貨號",horizontal:"",plaintext:""},model:{value:t.basic.item_no,callback:function(e){t.$set(t.basic,"item_no",e)},expression:"basic.item_no"}}),t._v(" "),o("CInput",{attrs:{label:"商品條碼",horizontal:"",plaintext:""},model:{value:t.basic.barcode,callback:function(e){t.$set(t.basic,"barcode",e)},expression:"basic.barcode"}}),t._v(" "),o("CInput",{attrs:{label:"商品規格",horizontal:"",plaintext:""},model:{value:t.basic.product_name,callback:function(e){t.$set(t.basic,"product_name",e)},expression:"basic.product_name"}}),t._v(" "),o("CInput",{attrs:{label:"商品規格",horizontal:"",plaintext:""},model:{value:t.basic.original_price,callback:function(e){t.$set(t.basic,"original_price",e)},expression:"basic.original_price"}}),t._v(" "),o("CInput",{attrs:{label:"上架時間",horizontal:"",plaintext:""},model:{value:t.basic.sales_start_time,callback:function(e){t.$set(t.basic,"sales_start_time",e)},expression:"basic.sales_start_time"}}),t._v(" "),o("CInput",{attrs:{label:"下架時間",format:"yyyy-MM-dd",horizontal:"",plaintext:""},model:{value:t.basic.sales_end_time,callback:function(e){t.$set(t.basic,"sales_end_time",e)},expression:"basic.sales_end_time"}}),t._v(" "),o("CInput",{attrs:{label:"單份人數/單位",horizontal:"",plaintext:""},model:{value:t.basic.pieces,callback:function(e){t.$set(t.basic,"pieces",e)},expression:"basic.pieces"}}),t._v(" "),o("CInput",{attrs:{label:"溫層",horizontal:"",plaintext:""},model:{value:t.basic.temperature_mode,callback:function(e){t.$set(t.basic,"temperature_mode",e)},expression:"basic.temperature_mode"}}),t._v(" "),o("CRow",{staticClass:"form-group",attrs:{form:""}},[o("CCol",{attrs:{sm:"3"}},[t._v("配送方式")]),t._v(" "),o("CCol",{staticClass:"form-inline",attrs:{sm:"9"}},[o("div",[o("b-form-checkbox-group",{attrs:{id:"checkbox-group-delivery",options:t.deliveryModeOptions},model:{value:t.product.deliveryModes,callback:function(e){t.$set(t.product,"deliveryModes",e)},expression:"product.deliveryModes"}})],1)])],1),t._v(" "),o("CSelect",{attrs:{label:"產品分類",horizontal:"",options:t.options,placeholder:"產品分類"}}),t._v(" "),o("CInput",{attrs:{label:"團購價格",placeholder:"團購價格",type:"number",horizontal:""},on:{blur:function(e){return t.checkPrice()}},model:{value:t.product.price,callback:function(e){t.$set(t.product,"price",e)},expression:"product.price"}}),t._v(" "),o("div",{staticClass:"form-group form-row",attrs:{role:"group"}},[o("label",{staticClass:"col-form-label col-sm-3"},[t._v("\n                商品圖片 (600*600)")]),t._v(" "),o("div",{staticClass:"col-sm-9"},[o("div",[t._l(t.product.uploadImgs,(function(e,r){return[e?o("img",{key:r,staticClass:"img-thumbnail",staticStyle:{width:"200px","margin-bottom":"10px"},attrs:{src:e}}):t._e()]}))],2),t._v(" "),o("div",[o("button",{staticClass:"btn btn-info",class:{disabled:t.product.uploadImgs.length>=3},attrs:{type:"button"},on:{click:function(e){return t.chooseFiles()}}},[t._v("\n                    上傳圖片 "+t._s(t.product.uploadImgs.length)+"/3\n                  ")]),t._v(" "),t._l(t.product.uploadImgs,(function(e,r,c){return[e?o("button",{key:c,staticClass:"btn btn-sm btn-link",attrs:{type:"button"},on:{click:function(e){return t.deleteImg(r)}}},[t._v("\n                      刪圖"+t._s(r+1)+"\n                    ")]):t._e()]}))],2),t._v(" "),o("input",{staticClass:"form-control-file",staticStyle:{width:"0px"},attrs:{id:"fileUpload",type:"file",accept:"image/png, image/jpeg"},on:{change:t.handleFileUpload}})])]),t._v(" "),o("CInput",{attrs:{label:"庫存數量",placeholder:"庫存數量",type:"number",horizontal:""},model:{value:t.product.inventoryQuantity,callback:function(e){t.$set(t.product,"inventoryQuantity",e)},expression:"product.inventoryQuantity"}}),t._v(" "),o("div",{staticClass:"form-group form-row",attrs:{role:"group"}},[o("label",{staticClass:"col-form-label col-sm-3"},[t._v(" 成團規則 ")]),t._v(" "),o("div",{staticClass:"col-sm-9"},[t._l(t.product.dealSettings,(function(e,r,c){return o("div",{key:r,staticClass:"mt-2"},[t._v("\n                  "+t._s(r+1)+".\n                  "),o("input",{directives:[{name:"model",rawName:"v-model",value:e.quantity_condition,expression:"item.quantity_condition"}],attrs:{type:"number"},domProps:{value:e.quantity_condition},on:{input:function(o){o.target.composing||t.$set(e,"quantity_condition",o.target.value)}}}),t._v("\n                  件成團，每個利潤\n                  "),o("input",{directives:[{name:"model",rawName:"v-model",value:e.profit,expression:"item.profit"}],attrs:{type:"number"},domProps:{value:e.profit},on:{blur:function(o){return t.checkProfit(e)},input:function(o){o.target.composing||t.$set(e,"profit",o.target.value)}}}),t._v(" 元\n                  "),e?o("button",{key:c,staticClass:"btn btn-sm btn-link",attrs:{type:"button"},on:{click:function(e){return t.deleteDealSetting(r)}}},[t._v("\n                    刪除\n                  ")]):t._e()])})),t._v(" "),o("div",{staticClass:"mt-2"},[o("button",{staticClass:"btn btn-info",attrs:{type:"button"},on:{click:function(e){return t.addDealSetting()}}},[o("span",{staticClass:"btn-label"}),t._v("+\n                  ")])])],2)]),t._v(" "),o("CRow",{staticClass:"form-group",attrs:{form:""}},[o("CCol",{attrs:{sm:"3"}},[t._v("強檔設定")]),t._v(" "),o("CCol",{staticClass:"form-inline",attrs:{sm:"9"}},[o("div",[o("b-form-checkbox-group",{attrs:{id:"checkbox-group-1",options:t.tagOptions},model:{value:t.product.tagNames,callback:function(e){t.$set(t.product,"tagNames",e)},expression:"product.tagNames"}})],1)])],1),t._v(" "),o("CRow",{staticClass:"form-group",attrs:{form:""}},[o("CCol",{attrs:{sm:"3"}},[t._v("是否為短效期")]),t._v(" "),o("CInputRadioGroup",{staticClass:"col-sm-9",attrs:{options:t.yesNoOptions,checked:t.product.shortLived,inline:!1},on:{"update:checked":function(e){return t.$set(t.product,"shortLived",e)}}})],1),t._v(" "),o("CRow",{staticClass:"form-group",attrs:{form:""}},[o("CCol",{attrs:{sm:"3"}},[t._v("是否適用7天鍵賞期")]),t._v(" "),o("CInputRadioGroup",{staticClass:"col-sm-9",attrs:{options:t.yesNoOptions,checked:t.product.appreciationPeriod,inline:!1},on:{"update:checked":function(e){return t.$set(t.product,"appreciationPeriod",e)}}})],1),t._v(" "),o("CTextarea",{attrs:{label:t.salesFocusLabel,placeholder:"銷售重點",maxlength:"500",horizontal:"",rows:"9"},on:{keyup:function(e){return t.calcWordCount("salesFocus")}},model:{value:t.product.salesFocus,callback:function(e){t.$set(t.product,"salesFocus",e)},expression:"product.salesFocus"}}),t._v(" "),o("CTextarea",{attrs:{label:t.featuresLabel,placeholder:"產品特色",maxlength:"500",horizontal:"",rows:"9"},on:{keyup:function(e){return t.calcWordCount("features")}},model:{value:t.product.features,callback:function(e){t.$set(t.product,"features",e)},expression:"product.features"}}),t._v(" "),o("CTextarea",{attrs:{label:t.othersLabel,placeholder:"其它說明",maxlength:"500",horizontal:"",rows:"9"},on:{keyup:function(e){return t.calcWordCount("others")}},model:{value:t.product.others,callback:function(e){t.$set(t.product,"others",e)},expression:"product.others"}}),t._v(" "),o("CRow",{staticClass:"form-group",attrs:{form:""}},[o("CCol",{staticClass:"col-form-label",attrs:{tag:"label",sm:"3"}},[t._v("\n                是否送審\n              ")]),t._v(" "),o("CCol",{attrs:{sm:"9"}},[o("CSwitch",{staticClass:"mr-1",attrs:{color:"primary","label-on":"Yes","label-off":"No",size:"lg",checked:!1}})],1)],1),t._v(" "),o("CRow",[o("CCol",{attrs:{md:"12"}},[o("hr"),t._v(" "),o("div",{staticClass:"h5"},[t._v("廠商聯絡資訊")]),t._v(" "),o("div",{staticClass:"h6"},[t._v("廠商簡稱: "+t._s(t.basic.supplier_name))]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.basic.supplier_contact,expression:"basic.supplier_contact"}],staticClass:"h6"},[t._v("\n                  廠商聯絡窗口: "+t._s(t.basic.supplier_contact)+"\n                ")]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.basic.supplier_contact_email,expression:"basic.supplier_contact_email"}],staticClass:"h6"},[t._v("\n                  廠商聯絡Email: "+t._s(t.basic.supplier_contact_email)+"\n                ")]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.basic.supplier_contact_number,expression:"basic.supplier_contact_number"}],staticClass:"h6"},[t._v("\n                  聯絡人電話: "+t._s(t.basic.supplier_contact_number)+"\n                ")])])],1),t._v(" "),o("CRow",{staticClass:"form-group",attrs:{form:""}},[o("CCol",{staticClass:"text-center",attrs:{md:"12"}},[o("button",{staticClass:"btn-secondary btn btn-lg",staticStyle:{display:"inline-block"},attrs:{type:"button"},on:{click:function(e){return t.cancel()}}},[t._v("\n                  取 消\n                ")]),t._v(" "),o("button",{staticClass:"btn-primary btn btn-lg ml-4",staticStyle:{display:"inline-block"},attrs:{type:"button"},on:{click:function(e){return t.save()}}},[t._v("\n                  儲存\n                ")])])],1)],1)],1),t._v(" "),o("CCardFooter")],1)],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports}}]);